<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Timing sequences at page loading</title>
    <style>
      h1 {
        font-size: 120%;
      }
      table {
        border-collapse: collapse;
      }
      td {
        border: 1px solid #666;
        padding: 0.3em 0.5em;
      }
    </style>
    <script>
      const logs = []
      const setLog = (name) => {
        logs.push({ name, time: performance.now() })
      }
      window.addEventListener('load', () => {
        setLog('load')
        requestAnimationFrame(() => {
          const table = document.createElement('table')
          table.innerHTML = `
          <tbody>
            ${logs
              .map(
                ({ name, time }, i) =>
                  `<tr><td>${i + 1} ${name}</td><td>${time.toFixed(
                    2
                  )}ms</td></tr>`
              )
              .join('')}
          </tbody>
        `
          document.body.appendChild(table)
        })
      })
      requestAnimationFrame(() => {
        setLog('requestAnimationFrame 1')
        requestAnimationFrame(() => {
          setLog('requestAnimationFrame 2')
        })
      })
      document.addEventListener('DOMContentLoaded', () => {
        setLog('DOMContentLoaded')
      })
      document.addEventListener('readystatechange', () => {
        setLog('readyState: ' + document.readyState)
      })
    </script>
    <script src="./script.js?name=head-module" type="module"></script>
    <script src="./script.js?name=head-defer" defer></script>
    <script src="./script.js?name=head-async" async></script>
    <script src="./script.js?name=head"></script>
  </head>
  <body>
    <h1>Timing sequences at page loading</h1>
    <script src="./script.js?name=body"></script>
  </body>
</html>
